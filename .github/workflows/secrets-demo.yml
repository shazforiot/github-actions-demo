# ===========================================
# Using Secrets & Environment Variables
# ===========================================
# NEVER hardcode sensitive data in your workflows!
# Use GitHub Secrets instead.

name: Secrets Demo

on:
  workflow_dispatch:          # Manual trigger only

# Global environment variables
env:
  APP_NAME: github-actions-demo
  NODE_ENV: production

jobs:
  demo:
    name: Secrets Demo
    runs-on: ubuntu-latest

    # Job-level environment variables
    env:
      LOG_LEVEL: info

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Access environment variables
      - name: Show environment variables
        run: |
          echo "App Name: $APP_NAME"
          echo "Node Env: $NODE_ENV"
          echo "Log Level: $LOG_LEVEL"

      # Access GitHub's built-in variables
      - name: Show GitHub context
        run: |
          echo "Repository: ${{ github.repository }}"
          echo "Branch: ${{ github.ref_name }}"
          echo "Commit SHA: ${{ github.sha }}"
          echo "Actor: ${{ github.actor }}"
          echo "Run ID: ${{ github.run_id }}"

      # Using secrets (set up in GitHub Settings > Secrets > Actions)
      - name: Use secrets safely
        env:
          # Map secrets to environment variables
          API_KEY: ${{ secrets.API_KEY }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
        run: |
          # Secrets are masked in logs automatically
          echo "API Key is set: $([[ -n "$API_KEY" ]] && echo 'Yes' || echo 'No')"

          # NEVER do this - secrets will be masked but it's bad practice:
          # echo "My secret: $API_KEY"

          # Instead, just use them in your application:
          # node deploy.js  (the script reads process.env.API_KEY)

      # Conditional based on secrets
      - name: Deploy if secrets exist
        if: ${{ secrets.DEPLOY_KEY != '' }}
        run: echo "Deployment secrets are configured!"

      # Using outputs between steps
      - name: Generate a value
        id: generate
        run: echo "random_id=$(date +%s)" >> $GITHUB_OUTPUT

      - name: Use the generated value
        run: echo "Generated ID: ${{ steps.generate.outputs.random_id }}"

# ===========================================
# HOW TO ADD SECRETS:
# ===========================================
# 1. Go to your GitHub repository
# 2. Click Settings > Secrets and variables > Actions
# 3. Click "New repository secret"
# 4. Add name (e.g., API_KEY) and value
# 5. Click "Add secret"
#
# Common secrets to add:
# - API_KEY: External service API keys
# - DATABASE_URL: Database connection strings
# - DEPLOY_KEY: Deployment credentials
# - SLACK_WEBHOOK: Notification webhooks
# - AWS_ACCESS_KEY_ID / AWS_SECRET_ACCESS_KEY: Cloud credentials
